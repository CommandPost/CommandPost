<script>{(js/jscolor.js)}</script>
<style>{(css/loupedeck.css)}</style>
<script>
	function changeColor(value) {
		document.getElementById('color').jscolor.fromString(value);
	}

	function changeImage(id, data) {
		document.getElementById(id).getElementsByTagName('img')[0].src = data;
	}

	function updateApplicationAndBank() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateApplicationAndBank",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function iconHistory() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "iconHistory",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					value: document.getElementById('color').jscolor.toString(),
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function clearIcon() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "clearIcon",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function updateBankLabel() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateBankLabel",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					bankLabel: document.getElementById("bankLabel").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function changeControl(element, label, controlType, id) {
		if (!label) {
			controlType = element.getAttribute("controlType");
			id = element.getAttribute("controlID");
			if (controlType == "touchButton") {
				if (id == "1") { label = "Touch Button 1" }
				if (id == "2") { label = "Touch Button 2" }
				if (id == "3") { label = "Touch Button 3" }
				if (id == "4") { label = "Touch Button 4" }
				if (id == "5") { label = "Touch Button 5" }
				if (id == "6") { label = "Touch Button 6" }
				if (id == "7") { label = "Touch Button 7" }
				if (id == "8") { label = "Touch Button 8" }
				if (id == "9") { label = "Touch Button 9" }
				if (id == "10") { label = "Touch Button 10" }
				if (id == "11") { label = "Touch Button 11" }
				if (id == "112") { label = "Touch Button 12" }
			}
			if (controlType == "knob") {
				if (id == "1") { label = "Knob 1" }
				if (id == "2") { label = "Knob 2" }
				if (id == "3") { label = "Knob 3" }
				if (id == "4") { label = "Knob 4" }
				if (id == "5") { label = "Knob 5" }
				if (id == "6") { label = "Knob 6" }
			}
			if (controlType == "jogWheel") {
				label = "Job Wheel";
			}
			if (controlType == "wheelScreen") {
				label = "Wheel Screen";
			}
			if (controlType == "ledButton") {
				if (id == "7") { label = "1"}
				if (id == "8") { label = "2"}
				if (id == "9") { label = "3"}
				if (id == "10") { label = "4"}
				if (id == "11") { label = "5"}
				if (id == "12") { label = "6"}
				if (id == "13") { label = "7"}
				if (id == "14") { label = "8"}
				if (id == "15") { label = "O"}
				if (id == "16") { label = "Undo"}
				if (id == "17") { label = "Keyboard"}
				if (id == "18") { label = "Return"}
				if (id == "19") { label = "Save"}
				if (id == "20") { label = "Fn (Left)"}
				if (id == "21") { label = "A"}
				if (id == "22") { label = "C"}
				if (id == "23") { label = "Fn (Right)"}
				if (id == "24") { label = "B"}
				if (id == "25") { label = "D"}
				if (id == "26") { label = "E"}
			}
		}

		// -------------------------------------------------
		// UPDATE LABEL UI:
		// -------------------------------------------------
		document.getElementById("label").innerHTML = label;

		// -------------------------------------------------
		// KNOB:
		// -------------------------------------------------
		if (controlType == "knob") {
			document.getElementById("spacerA").style.display = "block";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "none";
			document.getElementById("spacerD").style.display = "none";
			document.getElementById("spacerE").style.display = "block";

			document.getElementById("knobA").style.display = "table";
			document.getElementById("knobB").style.display = "table";
			document.getElementById("knobC").style.display = "table";

			document.getElementById("touchWheelA").style.display = "none";
			document.getElementById("touchWheelB").style.display = "none";
			document.getElementById("touchWheelC").style.display = "none";
			document.getElementById("touchWheelD").style.display = "none";
			document.getElementById("touchWheelE").style.display = "none";
			document.getElementById("touchWheelF").style.display = "none";
			document.getElementById("touchWheelG").style.display = "none";
			document.getElementById("touchWheelH").style.display = "none";
			document.getElementById("touchWheelI").style.display = "none";

			document.getElementById("pressActionA").style.display = "table";
			document.getElementById("pressActionB").style.display = "table";
			document.getElementById("pressActionC").style.display = "table";

			document.getElementById("iconA").style.display = "block";
			document.getElementById("iconB").style.display = "block";
			document.getElementById("iconC").style.display = "block";

			document.getElementById("ledColorA").style.display = "none";
			document.getElementById("ledColorB").style.display = "none";

			document.getElementById("iconLabel").style.display = "block";
			document.getElementById("iconLabelHeading").style.display = "table-cell";

			document.getElementById("buttonResolution").style.display = "none";
			document.getElementById("sideResolution").style.display = "none";
			document.getElementById("wheelResolution").style.display = "none";
			document.getElementById("knobResolution").style.display = "block";

			document.getElementById("vibrateA").style.display = "none";
			document.getElementById("vibrateB").style.display = "none";
		}

		// -------------------------------------------------
		// TOUCH BUTTON:
		// -------------------------------------------------
		if (controlType == "touchButton") {
			document.getElementById("spacerA").style.display = "block";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "none";
			document.getElementById("spacerD").style.display = "none";
			document.getElementById("spacerE").style.display = "none";

			document.getElementById("knobA").style.display = "none";
			document.getElementById("knobB").style.display = "none";
			document.getElementById("knobC").style.display = "none";

			document.getElementById("touchWheelA").style.display = "none";
			document.getElementById("touchWheelB").style.display = "none";
			document.getElementById("touchWheelC").style.display = "none";
			document.getElementById("touchWheelD").style.display = "none";
			document.getElementById("touchWheelE").style.display = "none";
			document.getElementById("touchWheelF").style.display = "none";
			document.getElementById("touchWheelG").style.display = "none";
			document.getElementById("touchWheelH").style.display = "none";
			document.getElementById("touchWheelI").style.display = "none";

			document.getElementById("pressActionA").style.display = "table";
			document.getElementById("pressActionB").style.display = "table";
			document.getElementById("pressActionC").style.display = "table";

			document.getElementById("iconA").style.display = "block";
			document.getElementById("iconB").style.display = "block";
			document.getElementById("iconC").style.display = "block";

			document.getElementById("ledColorA").style.display = "none";
			document.getElementById("ledColorB").style.display = "none";

			document.getElementById("buttonResolution").style.display = "block";
			document.getElementById("sideResolution").style.display = "none";
			document.getElementById("wheelResolution").style.display = "none";
			document.getElementById("knobResolution").style.display = "none";

			document.getElementById("iconLabel").style.display = "block";
			document.getElementById("iconLabelHeading").style.display = "table-cell";

			document.getElementById("vibrateA").style.display = "block";
			document.getElementById("vibrateB").style.display = "block";
		}

		// -------------------------------------------------
		// LED BUTTON:
		// -------------------------------------------------
		if (controlType == "ledButton") {
			document.getElementById("spacerA").style.display = "block";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "none";
			document.getElementById("spacerD").style.display = "none";
			document.getElementById("spacerE").style.display = "none";

			document.getElementById("knobA").style.display = "none";
			document.getElementById("knobB").style.display = "none";
			document.getElementById("knobC").style.display = "none";

			document.getElementById("touchWheelA").style.display = "none";
			document.getElementById("touchWheelB").style.display = "none";
			document.getElementById("touchWheelC").style.display = "none";
			document.getElementById("touchWheelD").style.display = "none";
			document.getElementById("touchWheelE").style.display = "none";
			document.getElementById("touchWheelF").style.display = "none";
			document.getElementById("touchWheelG").style.display = "none";
			document.getElementById("touchWheelH").style.display = "none";
			document.getElementById("touchWheelI").style.display = "none";

			document.getElementById("pressActionA").style.display = "table";
			document.getElementById("pressActionB").style.display = "table";
			document.getElementById("pressActionC").style.display = "table";

			document.getElementById("iconA").style.display = "none";
			document.getElementById("iconB").style.display = "none";
			document.getElementById("iconC").style.display = "none";

			document.getElementById("ledColorA").style.display = "block";
			document.getElementById("ledColorB").style.display = "block";

			document.getElementById("iconLabel").style.display = "none";
			document.getElementById("iconLabelHeading").style.display = "none";

			document.getElementById("vibrateA").style.display = "none";
			document.getElementById("vibrateB").style.display = "none";
		}

		// -------------------------------------------------
		// LEFT/RIGHT SCREENS:
		// -------------------------------------------------
		if (controlType == "sideScreen") {
			document.getElementById("spacerA").style.display = "none";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "block";
			document.getElementById("spacerD").style.display = "none";
			document.getElementById("spacerE").style.display = "block";

			document.getElementById("knobA").style.display = "none";
			document.getElementById("knobB").style.display = "none";
			document.getElementById("knobC").style.display = "none";

			document.getElementById("touchWheelA").style.display = "block";
			document.getElementById("touchWheelB").style.display = "block";
			document.getElementById("touchWheelC").style.display = "block";
			document.getElementById("touchWheelD").style.display = "none";
			document.getElementById("touchWheelE").style.display = "none";
			document.getElementById("touchWheelF").style.display = "none";

			document.getElementById("touchWheelG").style.display = "block";
			document.getElementById("touchWheelH").style.display = "block";
			document.getElementById("touchWheelI").style.display = "block";

			document.getElementById("pressActionA").style.display = "none";
			document.getElementById("pressActionB").style.display = "none";
			document.getElementById("pressActionC").style.display = "none";

			document.getElementById("iconA").style.display = "block";
			document.getElementById("iconB").style.display = "block";
			document.getElementById("iconC").style.display = "block";

			document.getElementById("ledColorA").style.display = "none";
			document.getElementById("ledColorB").style.display = "none";

			document.getElementById("buttonResolution").style.display = "none";
			document.getElementById("sideResolution").style.display = "block";
			document.getElementById("wheelResolution").style.display = "none";
			document.getElementById("knobResolution").style.display = "none";

			document.getElementById("iconLabel").style.display = "none";
			document.getElementById("iconLabelHeading").style.display = "none";

			document.getElementById("vibrateA").style.display = "none";
			document.getElementById("vibrateB").style.display = "none";
		}

		// -------------------------------------------------
		// JOG WHEEL:
		// -------------------------------------------------
		if (controlType == "jogWheel") {
			document.getElementById("spacerA").style.display = "none";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "none";
			document.getElementById("spacerD").style.display = "none";
			document.getElementById("spacerE").style.display = "none";

			document.getElementById("knobA").style.display = "table";
			document.getElementById("knobB").style.display = "table";
			document.getElementById("knobC").style.display = "table";

			document.getElementById("touchWheelA").style.display = "none";
			document.getElementById("touchWheelB").style.display = "none";
			document.getElementById("touchWheelC").style.display = "none";
			document.getElementById("touchWheelD").style.display = "none";
			document.getElementById("touchWheelE").style.display = "none";
			document.getElementById("touchWheelF").style.display = "none";
			document.getElementById("touchWheelG").style.display = "none";
			document.getElementById("touchWheelH").style.display = "none";
			document.getElementById("touchWheelI").style.display = "none";

			document.getElementById("pressActionA").style.display = "none";
			document.getElementById("pressActionB").style.display = "none";
			document.getElementById("pressActionC").style.display = "none";

			document.getElementById("iconA").style.display = "none";
			document.getElementById("iconB").style.display = "none";
			document.getElementById("iconC").style.display = "none";

			document.getElementById("ledColorA").style.display = "none";
			document.getElementById("ledColorB").style.display = "none";

			document.getElementById("iconLabel").style.display = "none";
			document.getElementById("iconLabelHeading").style.display = "none";

			document.getElementById("vibrateA").style.display = "none";
			document.getElementById("vibrateB").style.display = "none";
		}

		// -------------------------------------------------
		// WHEEL SCREEN:
		// -------------------------------------------------
		if (controlType == "wheelScreen") {
			document.getElementById("spacerA").style.display = "none";
			document.getElementById("spacerB").style.display = "none";
			document.getElementById("spacerC").style.display = "block";
			document.getElementById("spacerD").style.display = "block";
			document.getElementById("spacerE").style.display = "block";

			document.getElementById("knobA").style.display = "none";
			document.getElementById("knobB").style.display = "none";
			document.getElementById("knobC").style.display = "none";

			document.getElementById("touchWheelA").style.display = "block";
			document.getElementById("touchWheelB").style.display = "block";
			document.getElementById("touchWheelC").style.display = "block";
			document.getElementById("touchWheelD").style.display = "block";
			document.getElementById("touchWheelE").style.display = "block";
			document.getElementById("touchWheelF").style.display = "block";
			document.getElementById("touchWheelG").style.display = "block";
			document.getElementById("touchWheelH").style.display = "block";
			document.getElementById("touchWheelI").style.display = "block";

			document.getElementById("pressActionA").style.display = "none";
			document.getElementById("pressActionB").style.display = "none";
			document.getElementById("pressActionC").style.display = "none";

			document.getElementById("iconA").style.display = "block";
			document.getElementById("iconB").style.display = "block";
			document.getElementById("iconC").style.display = "block";

			document.getElementById("ledColorA").style.display = "none";
			document.getElementById("ledColorB").style.display = "none";

			document.getElementById("buttonResolution").style.display = "none";
			document.getElementById("sideResolution").style.display = "none";
			document.getElementById("wheelResolution").style.display = "block";
			document.getElementById("knobResolution").style.display = "none";

			document.getElementById("iconLabel").style.display = "none";
			document.getElementById("iconLabelHeading").style.display = "none";

			document.getElementById("vibrateA").style.display = "none";
			document.getElementById("vibrateB").style.display = "none";
		}

		// -------------------------------------------------
		// Save the selectedControl & ID in a hidden field:
		// -------------------------------------------------
		document.getElementById("selectedControl").value = label;
		document.getElementById("id").value = id;
		document.getElementById("controlType").value = controlType;

		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateUI",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					controlType: controlType,
					id: id,
					selectedControl: label,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function updateColor() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateColor",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					value: document.getElementById('color').jscolor.toString(),
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function updateIconLabel() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateIconLabel",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					value: document.getElementById('iconLabel').value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function selectButton(buttonType) {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateAction",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					id: document.getElementById("id").value,
					buttonType: buttonType,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function clearButton(buttonType) {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "clearAction",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					buttonType: buttonType,
					controlType: document.getElementById("controlType").value,
					id: document.getElementById("id").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function setIcon(encodedIcon) {
		if (encodedIcon != "") {
			document.getElementById("iconDropZonePreview").innerHTML = "<img src='" + encodedIcon + "'>";
    		document.getElementById("iconDropZone").className = "dropzone dropped";
    	} else {
			document.getElementById("iconDropZonePreview").innerHTML = "<p style=\"padding-top: 13px;\">icon</p>";
			document.getElementById("iconDropZone").className = "dropzone";
    	}
	}

	function pressIconDropZone(groupID, buttonID) {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "iconClicked",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					controlType: document.getElementById("controlType").value,
					id: document.getElementById("id").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function changeIconDropZone(element) {
		var file = element.files[0];

		element.classList.remove("hover");

		var match = element.accept.split(/, ?/).indexOf(file.type);

		if (element.accept && match == -1) {
			// File type dropped doesn't match the accepted list:
			try {
				var result = {
					id: "loupedeckCTPanelCallback",
					params: {
						type: "badExtension",
					},
				}
				postMessage(result);
			} catch(err) {
				alertErrorMessage(err);
			}
			return;
		};

		element.classList.add("dropped");

		var reader = new FileReader(file);
		reader.readAsDataURL(file);

		reader.onload = function(e) {
			var data = e.target.result;
			document.getElementById("iconDropZonePreview").innerHTML = '<img src="' + data + '" />';

			// Icon Callback:
			try {
				var result = {
					id: "loupedeckCTPanelCallback",
					params: {
						type: "updateIcon",
						application: document.getElementById("application").value,
						bank: document.getElementById("bank").value,
						selectedControl: document.getElementById("selectedControl").value,
						controlType: document.getElementById("controlType").value,
						id: document.getElementById("id").value,
						icon: data,
					},
				}
				postMessage(result);
			} catch(err) {
				alertErrorMessage(err);
			}

		};
	}

	function importSettings() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "importSettings",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function exportSettings() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "exportSettings",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function copyControlToAllBanks() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "copyControlToAllBanks",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function resetControl() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "resetControl",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					selectedControl: document.getElementById("selectedControl").value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function resetEverything() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "resetEverything",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function resetApplication() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "resetApplication",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function resetBank() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "resetBank",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function copyApplication() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "copyApplication",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function copyBank() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "copyBank",
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function updateVibrate() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "updateVibrate",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					id: document.getElementById("id").value,
					controlType: document.getElementById("controlType").value,
					value: document.getElementById("vibrate").value,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function changeIgnore() {
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "changeIgnore",
					application: document.getElementById("application").value,
					ignore: document.getElementById("ignore").checked,
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
	}

	function updateIgnoreVisibility() {
		if (document.getElementById("application").value == "All Applications") {
			document.getElementById("ignoreApp").style.display = "none";
		} else {
			document.getElementById("ignoreApp").style.display = "block";
		}
	}

	function showContextMenu(ev) {
		ev.preventDefault();
		try {
			var result = {
				id: "loupedeckCTPanelCallback",
				params: {
					type: "showContextMenu",
					application: document.getElementById("application").value,
					bank: document.getElementById("bank").value,
					controlType: ev.srcElement.parentElement.getAttribute("controlType"),
					id: ev.srcElement.parentElement.getAttribute("controlID"),
				},
			}
			postMessage(result);
		} catch(err) {
			alertErrorMessage(err);
		}
		return false;
	}

	function allowDrop(ev) {
		ev.dataTransfer.dropEffect = "copy";
		ev.preventDefault();
	}

	function drag(ev) {
		console.log("drag:")
		console.log(ev)
		ev.dataTransfer.setData("text", ev.target.parentElement.getAttribute("controlType") + ev.target.parentElement.getAttribute("controlID"));
	}

	function drop(ev, controlType, id) {

		ev.preventDefault();

		var controlType = ev.toElement.parentElement.getAttribute("controlType");
		var id = ev.toElement.parentElement.getAttribute("controlID");

		var dt = ev.dataTransfer
	    var files = dt.files
		var file = files[0]

	    if (file) {
	    	if (["image/png", "image/gif", "image/jpeg", "image/tiff"].indexOf(file.type) >= 0) {
				var reader = new FileReader(file);
				reader.readAsDataURL(file);

				reader.onload = function(e) {
					var data = e.target.result;

					var callbackType
					if (controlType == "knob") {
						callbackType = "updateKnobIcon";
					}
					if (controlType == "touchButton") {
						callbackType = "updateButtonIcon";
					}
					if (controlType == "sideScreen") {
						callbackType = "updateSideScreenIcon";
					}
					if (controlType == "wheelScreen") {
						callbackType = "updateWheelIcon";
					}

					// If this button is currently selected, change that too:
					if (controlType == "knob") {
						if (document.getElementById("controlType").value == "knob" && document.getElementById("id").value == id) {
							document.getElementById("iconDropZonePreview").innerHTML = '<img src="' + data + '" />';
							document.getElementById("iconDropZone").className = "dropzone dropped";
						}
					}

					if (controlType == "touchButton") {
						// Change button icon:
						ev.toElement.parentElement.getElementsByTagName("img")[0].src = data;

						// If this button is currently selected, change that too:
						if (document.getElementById("controlType").value == "touchButton" && document.getElementById("id").value == id) {
							document.getElementById("iconDropZonePreview").innerHTML = '<img src="' + data + '" />';
							document.getElementById("iconDropZone").className = "dropzone dropped";
						}
					}

					if (controlType == "sideScreen") {
						// If this button is currently selected, change that too:
						if (document.getElementById("controlType").value == "sideScreen" && document.getElementById("id").value == id) {
							document.getElementById("iconDropZonePreview").innerHTML = '<img src="' + data + '" />';
							document.getElementById("iconDropZone").className = "dropzone dropped";
						}
					}

					if (controlType == "wheelScreen") {
						// Change wheel icon:
						ev.toElement.parentElement.getElementsByTagName("img")[0].src = data;

						// If this button is currently selected, change that too:
						if (document.getElementById("controlType").value == "wheelScreen" && document.getElementById("id").value == id) {
							document.getElementById("iconDropZonePreview").innerHTML = '<img src="' + data + '" />';
							document.getElementById("iconDropZone").className = "dropzone dropped";
						}
					}

					// Icon Callback:
					try {
						var result = {
							id: "loupedeckCTPanelCallback",
							params: {
								type: callbackType,
								application: document.getElementById("application").value,
								bank: document.getElementById("bank").value,
								id: id,
								icon: data,
								controlType: controlType,
							},
						}
						postMessage(result);
					} catch(err) {
						alertErrorMessage(err);
					}

				};


	    	} else {
				// File type dropped doesn't match the accepted list:
				try {
					var result = {
						id: "loupedeckCTPanelCallback",
						params: {
							type: "badExtension",
						},
					}
					postMessage(result);
				} catch(err) {
					alertErrorMessage(err);
				}
				return;
	    	}
	    }
	    else {
			try {
				var result = {
					id: "loupedeckCTPanelCallback",
					params: {
						type: "dropAndDrop",
						application: document.getElementById("application").value,
						bank: document.getElementById("bank").value,
						source: ev.dataTransfer.getData("text"),
						destination: controlType + id,
					},
				}
				postMessage(result);
			} catch(err) {
				alertErrorMessage(err);
			}
		}
	}
</script>
<table>
	<thead>
		<tr>
			<th style="padding-left: 20px;">
				<a class="button importSettings" href="#" style="font-weight: normal;" onclick="importSettings()">{{ i18n("importSettings") }}</a>
			</th>
			<th style="padding-left: 10px;">
				<a class="button importSettings" href="#" style="font-weight: normal;" onclick="exportSettings()">{{ i18n("exportSettings") }}</a>
			</th>
		</tr>
	</thead>
</table>
<hr />
<table style="width: 1000px; text-align: left; vertical-align: text-bottom; padding-top: 10px; padding-left: 20px">
	<tr>
		<th style=text-align: left;">
			<span style="font-weight:normal; font-size:13px;">{{ i18n("application") }}: </span>
				<select id="application" style="width: 150px;" onchange="updateApplicationAndBank()">
					<option value="All Applications">{{ i18n("allApplications") }}</option>
					<option dttisabled>──────────</option>
					{%
					for id, label in spairs(builtInApps, function(t,a,b) return t[a] < t[b] end) do
						local selected = ""
						if lastApplication == id then
							selected = [[selected=""]]
						end
					%}
					<option {{selected}} value="{{id}}">{{label}}</option>
					{% end %}
					<option disabled>──────────</option>
					{%
					local atLeastOne = false
					for id, label in spairs(userApps, function(t,a,b) return t[a] < t[b] end) do
						atLeastOne = true
						local selected = ""
						if lastApplication == id then
							selected = [[selected=""]]
						end
					%}
					<option {{selected}} value="{{id}}">{{label}}</option>
					{%
					end
					if atLeastOne then
					%}
					<option disabled>──────────</option>
					{%
					end
					%}
					<option value="Add Application">{{ i18n("addApplication") }}</option>
				</select>
			</span>
		</th>
		<th style="padding-left: 20px;">
			<span style="font-weight:normal; font-size:13px;">{{ i18n("bank") }}: </span>
				<select id="bank" style="width: 100px;" onchange="updateApplicationAndBank()">
					{%
					for i=1, numberOfBanks do
						local selected = ""
						if lastBank == tostring(i) then
							selected = [[selected=""]]
						end
					%}
					<option {{selected}} value="{{i}}">{{i}}</option>
					{% end %}
					<option disabled>──────────</option>
					{%
					for i=1, numberOfBanks do
						local selected = ""
						if lastBank == tostring(i) .. "_LeftFn" then
							selected = [[selected=""]]
						end
					%}
					<option {{selected}} value="{{i}}_LeftFn">{{i}} (Left Fn)</option>
					{% end %}
					<option disabled>──────────</option>
					{%
					for i=1, numberOfBanks do
						local selected = ""
						if lastBank == tostring(i) .. "_RightFn" then
							selected = [[selected=""]]
						end
					%}
					<option {{selected}} value="{{i}}_RightFn">{{i}} (Right Fn)</option>
					{% end %}
				</select>
			</span>
		</th>
		<th style="padding-left: 20px;">
			<span style="font-weight:normal; font-size:13px; padding-left:5px;">{{ i18n("label") }}: </span>
			<input type="text" id="bankLabel" class="loupedeckLabel" value="{{ lastBankLabel }}" onchange="updateBankLabel()" placeholder="{{ i18n("none") }}">
		</th>
		<th style="padding-left: 20px; width: 200px; vertical-align:bottom;">
			<span id="ignoreApp">
				<input type="checkbox" value="ignore" id="ignore" onchange="changeIgnore()">
		  		<label for="ignore"> <span style="font-weight:normal; font-size:13px; padding-left:5px;">{{ i18n("ignoreApplication") }}</span></label>
	  		</span>
		</th>
	</tr>
</table>
<table>
	<thead>
		<tr>
			<th width="447px">
				<div id="loupedeckCT">
					<div controlType="knob" controlID="1" id="knob1" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob1.png') }}" width="39" height="39" />
					</div>
					<div controlType="knob" controlID="4" id="knob4" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob4.png') }}" width="39" height="39" />
					</div>
					<div controlType="sideScreen" controlID="1" id="sideScreen1" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/sideScreen1.png') }}" width="24" height="131" style="object-fit: cover;" />
					</div>
					<div controlType="touchButton" controlID="1" id="touchButton1" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton1.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="2" id="touchButton2" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton2.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="3" id="touchButton3" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton3.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="4" id="touchButton4" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton4.png') }}" width="40" height="40" />
					</div>
					<div controlType="sideScreen" controlID="2" id="sideScreen2" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/sideScreen2.png') }}" width="24" height="131" style="object-fit: cover;" />
					</div>
					<div controlType="touchButton" controlID="5" id="touchButton5" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton5.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="6" id="touchButton6" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton6.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="7" id="touchButton7" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton7.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="8" id="touchButton8" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton8.png') }}" width="40" height="40" />
					</div>
					<div controlType="knob" controlID="2" id="knob2" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob2.png') }}" width="39" height="38" />
					</div>
					<div controlType="knob" controlID="5" id="knob5" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob5.png') }}" width="39" height="38" />
					</div>
					<div controlType="touchButton" controlID="9" id="touchButton9" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton9.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="10" id="touchButton10" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton10.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="11" id="touchButton11" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton11.png') }}" width="40" height="40" />
					</div>
					<div controlType="touchButton" controlID="12" id="touchButton12" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/touchButton12.png') }}" width="40" height="40" />
					</div>
					<div controlType="knob" controlID="3" id="knob3" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob3.png') }}" width="39" height="39" />
					</div>
					<div controlType="knob" controlID="6" id="knob6" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/knob6.png') }}" width="39" height="39" />
					</div>
					<div controlType="ledButton" controlID="7" id="ledButton1" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton1.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="8" id="ledButton2" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton2.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="9" id="ledButton3" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton3.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="10" id="ledButton4" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton4.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="11" id="ledButton5" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton5.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="12" id="ledButton6" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton6.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="13" id="ledButton7" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton7.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="14" id="ledButton8" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButton8.png') }}" width="33" height="33" />
					</div>
					<div controlType="ledButton" controlID="15" id="ledButtonO" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonO.png') }}" width="46" height="46" />
					</div>
					<div controlType="ledButton" controlID="18" id="ledButtonReturn" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonReturn.png') }}" width="45" height="46" />
					</div>
					<div controlType="ledButton" controlID="21" id="ledButtonA" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonA.png') }}" width="47" height="46" />
					</div>
					<div controlType="ledButton" controlID="24" id="ledButtonB" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonB.png') }}" width="46" height="46" />
					</div>
					<div controlType="jogWheel" controlID="1" id="jogWheelTop" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)" draggable="false">
						<img src="{{ insertImage('images/jogWheelTop.png') }}" width="135" height="27" draggable="false" />
					</div>
					<div controlType="jogWheel" controlID="1" id="jogWheelLeft" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)" draggable="false">
						<img src="{{ insertImage('images/jogWheelLeft.png') }}" width="28" height="107" draggable="false" />
					</div>
					<div controlType="wheelScreen" controlID="1" id="wheelScreen1" draggable="false" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/wheelScreen1.png') }}" width="81" height="82" border="0" style="border-radius: 50%;" draggable="false" />
					</div>
					<div controlType="jogWheel" controlID="1" id="jogWheelRight" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)" draggable="false">
						<img src="{{ insertImage('images/jogWheelRight.png') }}" width="26" height="107" draggable="false" />
					</div>
					<div controlType="ledButton" controlID="16" id="ledButtonUndo" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonUndo.png') }}" width="46" height="46" />
					</div>
					<div controlType="ledButton" controlID="19" id="ledButtonSave" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonSave.png') }}" width="45" height="46" />
					</div>
					<div controlType="ledButton" controlID="22" id="ledButtonC" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonC.png') }}" width="47" height="46" />
					</div>
					<div controlType="ledButton" controlID="25" id="ledButtonD" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonD.png') }}" width="46" height="46" />
					</div>
					<div controlType="ledButton" controlID="17" id="ledButtonKeyboard" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonKeyboard.png') }}" width="46" height="46" />
					</div>
					<div controlType="ledButton" controlID="20" id="ledButtonLeftFn" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonLeftFn.png') }}" width="45" height="46" />
					</div>
					<div controlType="ledButton" controlID="23" id="ledButtonRightFn" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonRightFn.png') }}" width="47" height="46" />
					</div>
					<div controlType="ledButton" controlID="26" id="ledButtonE" draggable="true" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)">
						<img src="{{ insertImage('images/ledButtonE.png') }}" width="46" height="46" />
					</div>
					<div controlType="jogWheel" controlID="1" id="jogWheelBottom" onclick="changeControl(this)" style="cursor: pointer;" oncontextmenu="showContextMenu(event)" draggable="false">
						<img src="{{ insertImage('images/jogWheelBottom.png') }}" width="81" height="25" draggable="false" />
					</div>
				</div>
			</th>
			<th style="text-align:top; padding-top: 20px;">

				<p style="text-align: left; padding-left:20px; font-size:16px; margin: 0px;">
					<strong>{{ i18n("selectedControl") }}:</strong> <span id="label" style="font-weight: normal;"></span>
				</p>
				<div id="loupedeckGroupControls" class="uiItem">
					<table class="loupedeck" style="height: 526px;" id="noLoupedeck">
						<tr>
							<th>
								<p style="font-size: 12px; font-weight: normal;">{{ i18n("loupedeckCTStoreSettingsOnFlashDriveLineOne") }}</p>
								<p style="font-size: 12px; font-weight: normal;">{{ i18n("loupedeckCTStoreSettingsOnFlashDriveLineTwo") }}</p>
							</th>
						</tr>
					</table>
					<table class="loupedeck" style="height: 526px; display: none;" id="yesLoupedeck">
						<!-- PRESS ACTION, LED COLOR & VIBRATE: -->
						<tr id="pressActionA">
							<th width="229px">{{ i18n("pressAction") }}:</th>
							<th width="229px" id="ledColorA">{{ i18n("ledColor") }}:</th>
							<th width="229px" id="vibrateA">{{ i18n("vibrateWhenPressed") }}:</th>
						</tr>
						<tr id="pressActionB">
							<td width="229px"><input type="text" id="press_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
							<td width="229px" id="ledColorB">
								<div>
									<input id="color" class="loupedeckActionTextbox jscolor {hash:true, borderColor:'#FFF', insetColor:'#FFF', backgroundColor:'#666'}" onchange="updateColor()" value="">
								</div>
							</td>
							<td width="229px" id="vibrateB">
								<select id="vibrate" style="width: 210px;" onchange="updateVibrate()">
									<option value="">{{ i18n("none") }}</option>
									{%
									for id, label in pairs(vibrationIndex) do
									%}
									<option value="{{id}}">{{label}}</option>
									{%
									end
									%}
								</select>
							</td>
						</tr>
						<tr id="pressActionC">
							<td width="229px"><a id="press_actionButton" href="#" class="button loupedeckActionButton" onclick="selectButton('pressAction')">{{ i18n("select") }}</a> <a id="press_clearButton" href="#" class="button loupedeckActionButton" onclick="clearButton('pressAction')">{{ i18n("clear") }}</a></td>
							<td width="229px"></td>
						</tr>

						<!-- SPACER: -->
						<tr id="spacerA">
							<td>
								</br>
							</td>
						</tr>

						<!-- KNOB LEFT & RIGHT: -->
						<tr id="knobA">
							<th width="229px">{{ i18n("turnLeftAction") }}:</th>
							<th width="229px">{{ i18n("turnRightAction") }}:</th>
						</tr>
						<tr id="knobB">
							<td width="229px"><input type="text" id="left_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
							<td width="229px"><input type="text" id="right_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
						</tr>
						<tr id="knobC">
							<td width="229px"><a id="left_actionButton" href="#" class="button loupedeckActionButton" onclick="selectButton('leftAction')">{{ i18n("select") }}</a> <a id="left_clearButton" href="#" class="button loupedeckActionButton" onclick="clearButton('leftAction')">{{ i18n("clear") }}</a></td>
							<td width="229px"><a id="right_actionButton" href="#" class="button loupedeckActionButton" onclick="selectButton('rightAction')">{{ i18n("select") }}</a> <a id="right_clearButton" href="#" class="button loupedeckActionButton" onclick="clearButton('rightAction')">{{ i18n("clear") }}</a></td>
						</tr>

						<!-- SPACER: -->
						<tr id="spacerB">
							<td>
								</br>
							</td>
						</tr>

						<!-- TOUCH WHEEL UP & DOWN : -->
						<tr id="touchWheelA">
							<th width="229px">{{ i18n("slideUpAction") }}:</th>
							<th width="229px">{{ i18n("slideDownAction") }}:</th>
						</tr>
						<tr id="touchWheelB">
							<td width="229px"><input type="text" id="up_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
							<td width="229px"><input type="text" id="down_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
						</tr>
						<tr id="touchWheelC">
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('upAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('upAction')">{{ i18n("clear") }}</a></td>
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('downAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('downAction')">{{ i18n("clear") }}</a></td>
						</tr>

						<!-- SPACER: -->
						<tr id="spacerC">
							<td>
								</br>
							</td>
						</tr>

						<!-- TOUCH WHEEL LEFT & RIGHT : -->
						<tr id="touchWheelD">
							<th width="229px">{{ i18n("slideLeftAction") }}:</th>
							<th width="229px">{{ i18n("slideRightAction") }}:</th>
						</tr>
						<tr id="touchWheelE">
							<td width="229px"><input type="text" id="left_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
							<td width="229px"><input type="text" id="right_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
						</tr>
						<tr id="touchWheelF">
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('leftAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('leftAction')">{{ i18n("clear") }}</a></td>
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('rightAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('rightAction')">{{ i18n("clear") }}</a></td>
						</tr>

						<!-- SPACER: -->
						<tr id="spacerD">
							<td>
								</br>
							</td>
						</tr>

						<!-- TOUCH WHEEL DOUBLE TAP & TWO FINGER TAP : -->
						<tr id="touchWheelG">
							<th width="229px">{{ i18n("doubleTap") }}:</th>
							<th width="229px">{{ i18n("twoFingerTap") }}:</th>
						</tr>
						<tr id="touchWheelH">
							<td width="229px"><input type="text" id="double_tap_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
							<td width="229px"><input type="text" id="two_finger_touch_action" class="loupedeckActionTextbox" value="" disabled="" placeholder="{{ i18n("none") }}"></td>
						</tr>
						<tr id="touchWheelI">
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('doubleTapAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('doubleTapAction')">{{ i18n("clear") }}</a></td>
							<td width="229px"><a href="#" class="button loupedeckActionButton" onclick="selectButton('twoFingerTapAction')">{{ i18n("select") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearButton('twoFingerTapAction')">{{ i18n("clear") }}</a></td>
						</tr>

						<!-- SPACER: -->
						<tr id="spacerE">
							<td>
								</br>
							</td>
						</tr>

						<!-- ICON: -->
						<tr id="iconA">
							<th width="229px">{{ i18n("imageDropZone") }}:</th>
							<th width="229px" id="iconLabelHeading">{{ i18n("textLabel") }}:</th>
						</tr>
						<tr id="iconB">
							<td width="229px">
								<div id="iconDropZone" class="dropzone{{ class }}" ondragover="this.classList.add('hover')" ondragleave="this.classList.remove('hover')">
									<div id="iconDropZonePreview" ondragover="this.classList.add('hover')" ondragleave="this.classList.remove('hover')">
										<p style="padding-top: 13px;">icon</p>
									</div>
									<input id="iconDropZoneInput" type="file" accept="image/png, image/gif, image/jpeg, image/tiff" onchange="changeIconDropZone(this)" onclick="pressIconDropZone()" />
								</div>
							</td>
							<td width="229px" style="vertical-align: top;">
								<textarea id="iconLabel" class="loupedeckActionTextbox" style="resize: none;" rows="5" cols="5" placeholder="{{ i18n("none") }}" onchange="updateIconLabel()"></textarea>
							</td>
						</tr>
						<tr id="iconC">
							<th width="229px" id="buttonResolution"><i style="color: #FFFFFF; padding-left: 16px;">90 x 90 pixels</i></th>
							<th width="229px" id="sideResolution"><i style="color: #FFFFFF; padding-left: 14px;">60 x 270 pixels</i></th>
							<th width="229px" id="wheelResolution"><i style="color: #FFFFFF; padding-left: 10px;">240 x 240 pixels</i></th>
							<th width="229px" id="knobResolution"><i style="color: #FFFFFF; padding-left: 16px;">90 x 60 pixels</i></th>
							<th width="229px">
								<a href="#" class="button loupedeckActionButton" onclick="iconHistory()">{{ i18n("history") }}</a> <a href="#" class="button loupedeckActionButton" onclick="clearIcon()">{{ i18n("clear") }}</a>
							</th>
						</tr>
						<tr style="padding-top: 10px;">
							<th>
								<a href="#" class="bottomButton" onclick="copyControlToAllBanks()">{{ i18n("copyControlToAllBanks") }}</a>
							</th>
							<th>
								<a href="#" class="bottomButton" onclick="resetControl()">{{ i18n("resetControl") }}</a>
							</th>
						</tr>

					</table>
				</div>
			</th>
		</tr>
	</thead>
</table>

<table>
	<tr>
		<th style="height: 10px;"></th>
	</tr>
	<tr>
		<th style="width: 10px;"></th>
		<th>
			<a href="#" class="bottomButton" onclick="resetEverything()">{{ i18n("resetEverything") }}</a>
		</th>
		<th>
			<a href="#" class="bottomButton" onclick="resetApplication()">{{ i18n("resetApplication") }}</a>
		</th>
		<th>
			<a href="#" class="bottomButton" onclick="resetBank()">{{ i18n("resetBank") }}</a>
		</th>
	</tr>
	<tr>
		<th style="width: 10px;"></th>
		<th>
			<a href="#" class="bottomButton" onclick="copyApplication()">{{ i18n("copyApplication") }}</a>
		</th>
		<th>
			<a href="#" class="bottomButton" onclick="copyBank()">{{ i18n("copyBank") }}</a>
		</th>
	</tr>
</table>

<input type="hidden" id="selectedControl" value="{{ lastSelectedControl }}">
<input type="hidden" id="id" value="{{ lastID }}">
<input type="hidden" id="controlType" value="{{ lastControlType }}">

<script>
	// Update UI on initial load:
	changeControl("", "{{ lastSelectedControl }}", "{{ lastControlType }}", "{{ lastID }}");
</script>